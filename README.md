# Yet another photo gellery

This is yet another photo gallery, as a rails application.

## Demo

[Live demo](http://jumper.cc)

## Features

- albums' tree
 - with thumbnails
 - with password protected albums
 - with hidden albums
- different photos' sizes (site visitor can select any from interface)
- tags
 - can add tags to photos
 - and view photos with specified tags
 - and tags' cloud page
- upload dates
 - can view photos uploaded on specified date
 - and dates' list page (with thumbnails)
 - can select a photo to be a thumbnail for photo's date
- slideshow
- keyboard navigation supported
- site visitor can select
 - photos size
 - language (there are english and russian locales, you can add more)
 - photos order
- batch upload via console
 - all images sizes are autogenerated
 - watermark (`lib/sign.jpg`) adds automaticaly
- admin interface additions
 - to edit albums/photos
 - to assign tags
 - to move photos
 - to create albums
 - to delete albums or photos
 - to select a photo to be a thumbnail for album or date
- one pager with AJAX
 - photos loading on scroll
 - there is a version without JavaScript (used when JavaScript is disabled or for web robots)
- https for password protected albums and admin panel
 - admin panel swown only with https
 - https only cookies (except settings cookies)

## How to start

- download source code
- run `bundle install`
- run `RAILS_ENV=production rake db:setup`
- create admin user
 - run `rails console production`
 - in console run `User.create!( name: 'CHANGE ME', password: 'CHANGE ME' )`, but change `CHANGE ME`'s to aproppriate values
- set production `secret_key_base` and `album_hash_salt` in `config/secrets.yml`
- change favicon (`public/favicon.ico`) and `public/image_stub.png`
- configure `nginx` with `passenger`
 - example config in the next section
 - or you can use any other web server/environment
- change watermark image (`lib/sign.jpg`)
- run `script/refresh-assets.sh`
- run `nginx`
- upload your photos

## Exmple nginx config

```
worker_processes  2;
user www;

error_log  /home/www/nginx/logs/error.log;
pid /home/www/nginx/logs/nginx.pid;
events {
    worker_connections  1024;
}

http {
    passenger_root /home/www/ruby/lib/ruby/gems/2.1.0/gems/passenger-4.0.42;
    passenger_ruby /home/www/ruby/bin/ruby;
    passenger_user_switching on;
    passenger_user www;
    passenger_group www;
    ssl_protocols TLSv1.1 TLSv1.2;
    gzip            on;
    gzip_min_length 1000;
    gzip_types      text/css application/javascript application/font-woff application/json;

    include       mime.types;
    default_type  application/octet-stream;
    server_names_hash_bucket_size 64;
    charset utf-8;

    ssl_protocols        SSLv3 TLSv1;
    ssl_ciphers          AES128-SHA:AES256-SHA:RC4-SHA:DES-CBC3-SHA:RC4-MD5;
    ssl_session_cache    shared:SSL:10m;
    ssl_session_timeout  10m;

    sendfile on;

    server {
        listen 127.0.0.1:80;
        server_name your.domain;
        root /home/www/your.domain/public ;

        location ~ \.(jpg|png|js|css|woff)$ {
            expires max;
        }

        passenger_enabled on;

        access_log /home/www/your.domain/log/access_log combined;
        error_log  /home/www/your.domain/log/error_log;
    }

    server {
        listen 127.0.0.1:443;
        server_name your.domain;

        ssl on;
        ssl_certificate      /home/www/nginx/your.domain.crt;
        ssl_certificate_key  /home/www/nginx/your.domain.key;
        ssl_verify_depth 3;
        keepalive_timeout    70;

        server_name jumper.cc;
        root /home/www/your.domain/public ;
        passenger_enabled on;

        access_log /home/www/your.domain/log/access_log combined;
        error_log  /home/www/your.domain/log/error_log;
    }
}
```

## How to upload photos

- run `mkdir -p tmp/upload public/albums/1200x800 public/albums/750x500 public/albums/thumbs`
- pace your photos (`*.jpg`) into `/tmp/upload` folder
- run `RAILS_ENV=production script/upload_new.sh`
- go to `https://your.domain`
- sign in using `Admininstration` menu item
- go to `upload` album thru `Admininstration / Upload album` menu item
- edit/move uploaded photos

## Development features

- backend
 - rails 4
 - passenger
 - paperclip
 - will_paginate for nojs version
 - files stored on filesystem
 - sqlite database
- frontend
 - jQuery
 - Twitter bootstrap
 - Mustache.js
 - sass

## Known bugs and limitations

- no web upload yet
- no tags creation yet
- AJAX version doesn't work in Internet Explorer

